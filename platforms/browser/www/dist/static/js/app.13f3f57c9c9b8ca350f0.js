webpackJsonp([1],{"/mnG":function(t,e){},"77eN":function(t,e){t.exports={CLIENT_ID:"7V1pVHASnLjlxJY8F7UBCBDoqsZ35aU0",CLIENT_DOMAIN:"gangplank.auth0.com",AUDIENCE:"https://log.com",REDIRECT:"com.gp.botmanager://gangplank.auth0.com/cordova/com.gp.botmanager/callback",BOT_URL:"https://gp-messbot.herokuapp.com"}},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("7+uW"),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var s=n("VU/8")({name:"App"},a,!1,function(t){n("evEA")},null,null).exports,i=n("/ocq"),r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("nav",{staticClass:"navbar navbar-inverse navbar-fixed-top"},[e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"navbar-header"},[e("a",{staticClass:"navbar-brand"},[this._v("Bot Manager")]),this._v(" "),e("button",{staticClass:"btn btn-danger",attrs:{"data-toggle":"modal","data-target":"#bot-info-modal"},on:{click:this.addBot}},[this._v("\n          Add new bot\n        ")])])])])])},staticRenderFns:[]};var l=n("VU/8")({name:"TopNav",methods:{addBot:function(){this.$parent.infoMode="add"}}},r,!1,function(t){n("ZT89")},"data-v-07ea9203",null).exports,c=n("ytdl"),d=n.n(c),u=n("2fyi"),m=n.n(u),g=n("77eN"),p=n.n(g);const f=p.a.CLIENT_ID,h=p.a.CLIENT_DOMAIN,v=p.a.AUDIENCE,b=p.a.REDIRECT,_="access_token";var C=new m.a.WebAuth({clientID:f,domain:h});new i.a({mode:"history"});function w(){return window.localStorage.getItem(_)}function k(){const t=w();return!(!t||(e=t,function(t){const e=d()(t);if(!e.exp)return null;const n=new Date(0);return n.setUTCSeconds(e.exp),n}(e)<new Date));var e}var B=n("mtWM"),y=n.n(B);const I={headers:{Authorization:`Bearer ${w()}`}};var x={name:"TopNav",methods:{handleLogin:function(){C.authorize({responseType:"token id_token",redirectUri:b,audience:v})},sendLogAway:async function(){if(!k())return alert("Please log in to continue"),!1;let t,e=`${g.BOT_URL}/api/log`;try{t=await y.a.post(e,{},I)}catch(t){return t.response?alert(`${t.response.status} - ${t.response.data}`):alert(JSON.stringify(t)),!1}return alert(`${t.status} - ${t.data}`),!0},checkToken:function(){alert("Access token: "+(k()?"true":"false"))}}},D={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("nav",{staticClass:"navbar navbar-fixed-bottom"},[n("div",{staticClass:"container-fluid"},[n("button",{on:{click:t.handleLogin}},[t._v("Log in")]),t._v(" "),n("button",{on:{click:t.checkToken}},[t._v("Check token")]),t._v(" "),n("button",{on:{click:t.sendLogAway}},[t._v("Send log")])])])])},staticRenderFns:[]};var T=n("VU/8")(x,D,!1,function(t){n("/mnG")},"data-v-6e89d93c",null).exports,N=n("fZjL"),S=n.n(N);const E=["email","msg","start","stop"];function L(t,e){for(let n in e)if(e[n])if("stop"!=n)window.localStorage.setItem(`${t}_${n}`,e[n]);else{if("null"==e.stop){window.localStorage.removeItem(`${t}_stop`),window.localStorage.removeItem(`${t}_start`);continue}let o=e[n].split(":"),a=new Date,s=a.getTime();s-=36e5*a.getHours(),s-=6e4*a.getMinutes(),s-=1e3*a.getSeconds(),a.getHours()<parseInt(o[0])&&(s+=864e5),s+=36e5*parseInt(o[0])+6e4*parseInt(o[1]),window.localStorage.setItem(`${t}_stop`,s),window.localStorage.getItem(`${t}_start`)||window.localStorage.setItem(`${t}_start`,a.getTime())}alert("Done")}var M={name:"BotInfo",props:["infoMode","bot"],data:function(){return{inputData:["name","email","msg"],pickerData:["start","stop"],editCheckbox:{name:!1,email:!1,msg:!1,start:!1,stop:!1},newBot:{name:"",email:"",msg:""},botChanges:{},deleteMode:""}},mounted:function(){var t=this;$("#bot-info-modal").on("hidden.bs.modal",function(){t.discardChanges(),$("#are-you-sure").collapse("hide"),$("textarea").css("height","15vh")}),$("#are-you-sure").on("show.bs.collapse",function(){$("#bot-info-modal").animate({scrollTop:$("#bot-info-modal").prop("scrollHeight")},400)})},methods:{refresh:function(){$("#bot-info-modal").modal("hide"),this.$parent.getBotList()},setEdit:function(t){this.editCheckbox[t]?delete this.botChanges[t]:this.botChanges[t]=this.bot[t],this.editCheckbox[t]=!this.editCheckbox[t]},setDeleteMode:function(t){this.deleteMode=t},parseTime:function(t){return t?new Date(parseInt(t)).toLocaleDateString("en-GB",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"none"},getStop:function(t){var e=t.split(":"),n=new Date,o=n.getTime();return o-=36e5*n.getHours(),o-=6e4*n.getMinutes(),o-=1e3*n.getSeconds(),n.getHours()>parseInt(e[0])&&(o+=864e5),o+=36e5*parseInt(e[0])+6e4*parseInt(e[1])},discardNewBot:function(){var t=this;S()(this.newBot).forEach(function(e){t.newBot[e]=""})},discardChanges:function(){var t=this,e=S()(this.botChanges);0!=e.length&&e.forEach(function(e){delete t.botChanges[e],t.editCheckbox[e]=!1})},isRunning:function(){return this.bot.stop&&parseInt(this.bot.stop)>(new Date).getTime()},stopRunningTimer:function(){var t=this;window.plugins.spinnerDialog.show("Stop timer","Please wait",!0),async function(t){if(!k())return alert("Please log in to continue"),!1;let e,n=`${g.BOT_URL}/api/stop`;try{e=await y.a.post(n,{email:t},I)}catch(t){t.response?alert(`${t.response.status} - ${t.response.data}`):alert(JSON.stringify(t)),e=null}return!!e&&(alert(`${e.status} - ${e.data}`),!0)}(this.bot.email).then(function(e){window.plugins.spinnerDialog.hide(),e&&(L(t.bot.name,{stop:"null"}),t.refresh())})},addNewBot:function(){!function(t){if(!t.name)return void alert("No enough data");let e=window.localStorage.getItem("bot_list");window.localStorage.setItem("bot_list",e?`${e}, ${t.name}`:t.name);for(let e in t)window.localStorage.setItem(`${t.name}_${e}`,t[e]);alert("New bot added")}(this.newBot),this.refresh()},updateRunningBot:function(){var t=this;window.plugins.spinnerDialog.show("Sending update to server","Please wait",!0);var e={email:this.bot.email};this.botChanges.stop&&(e.stop=this.getStop(this.botChanges.stop)),this.botChanges.msg&&(e.msg=this.botChanges.msg),async function(t){if(!k())return alert("Please log in to continue"),!1;let e,n=`${g.BOT_URL}/api/update`;try{e=await y.a.post(n,t,I)}catch(t){return t.response?alert(`${t.response.status} - ${t.response.data}`):alert(JSON.stringify(t)),!1}return alert(`${e.status} - ${e.data}`),!0}(e).then(function(e){window.plugins.spinnerDialog.hide(),e?(L(t.bot.name,t.botChanges),t.refresh()):t.discardChanges()})},startBotTimer:function(){var t=this;navigator.notification.confirm("Do you want to login using appstate ?",function(e){t.bot.useAppstate=1==e,window.plugins.spinnerDialog.show("Starting timer","Please wait",!0),async function(t){if(!k())return alert("Please log in to continue"),!1;let e,n=`${g.BOT_URL}/api/set`;try{e=await y.a.post(n,t,I)}catch(t){return t.response?alert(`${t.response.status} - ${t.response.data}`):alert(JSON.stringify(t)),!1}return alert(`${e.status} - ${e.data}`),!0}({stop:t.getStop(t.botChanges.stop),email:t.bot.email,msg:t.botChanges.msg||t.bot.msg}).then(function(e){window.plugins.spinnerDialog.hide(),e?(L(t.bot.name,t.botChanges),t.refresh()):t.discardChanges()})},"Before you go",["Yes","No"])},editBotInfo:function(){this.isRunning()&&(this.botChanges.stop||this.botChanges.msg)?this.updateRunningBot():this.isRunning()||!this.botChanges.stop?(L(this.bot.name,this.botChanges),this.refresh()):this.startBotTimer()},deleteBot:function(){this.isRunning()?alert("Please stop this bot first"):(!function(t){E.forEach(e=>{window.localStorage.removeItem(`${t}_${e}`)});let e=window.localStorage.getItem("bot_list").split(", ");window.localStorage.setItem("bot_list",e.filter(e=>e!=t).join(", ")),alert("Done")}(this.bot.name),this.refresh())}}},R={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal fade",attrs:{role:"dialog",id:"bot-info-modal"}},[n("div",{staticClass:"modal-dialog"},[n("div",{staticClass:"modal-content"},[n("div",{staticClass:"modal-header"},[n("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[t._v("\n          Ã—\n        ")]),t._v(" "),n("h4",{staticClass:"modal-title"},[t._v("\n          "+t._s("add"==t.infoMode?"Add new bot":"Bot info")+"\n        ")])]),t._v(" "),n("div",{staticClass:"modal-body"},[t._l(t.inputData,function(e){return n("div",{staticClass:"form-horizontal"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"control-label col-sm-2"},[t._v("\n              "+t._s(e[0].toUpperCase()+e.slice(1))+":\n            ")]),t._v(" "),n("div",{staticClass:"col-sm-8"},["add"==t.infoMode?n("input",{directives:[{name:"model",rawName:"v-model",value:t.newBot[e],expression:"newBot[item]"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.newBot[e]},on:{input:function(n){n.target.composing||t.$set(t.newBot,e,n.target.value)}}}):t._e(),t._v(" "),"info"!=t.infoMode||t.editCheckbox[e]||"msg"==e?t._e():n("div",{staticClass:"form-control"},[t._v("\n                "+t._s(t.bot[e])+"\n              ")]),t._v(" "),"info"!=t.infoMode||t.editCheckbox[e]||"msg"!=e?t._e():n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bot[e],expression:"bot[item]"}],staticClass:"form-control",attrs:{rows:"3",readonly:""},domProps:{value:t.bot[e]},on:{input:function(n){n.target.composing||t.$set(t.bot,e,n.target.value)}}}),t._v(" "),"info"==t.infoMode&&t.editCheckbox[e]&&"msg"!=e?n("input",{directives:[{name:"model",rawName:"v-model",value:t.botChanges[e],expression:"botChanges[item]"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.botChanges[e]},on:{input:function(n){n.target.composing||t.$set(t.botChanges,e,n.target.value)}}}):t._e(),t._v(" "),"info"==t.infoMode&&t.editCheckbox[e]&&"msg"==e?n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.botChanges[e],expression:"botChanges[item]"}],staticClass:"form-control",attrs:{rows:"3"},domProps:{value:t.botChanges[e]},on:{input:function(n){n.target.composing||t.$set(t.botChanges,e,n.target.value)}}}):t._e()]),t._v(" "),"info"==t.infoMode?n("div",{staticClass:"col-sm-1"},[t.editCheckbox[e]||"name"==e?t._e():n("button",{staticClass:"btn btn-primary",on:{click:function(n){t.setEdit(e)}}},[t._v("\n                Edit\n              ")]),t._v(" "),t.editCheckbox[e]?n("button",{staticClass:"btn btn-danger",on:{click:function(n){t.setEdit(e)}}},[t._v("\n                Reset\n              ")]):t._e()]):t._e()])])}),t._v(" "),t._l(t.pickerData,function(e){return"info"==t.infoMode?n("div",{staticClass:"form-horizontal"},[n("div",{staticClass:"form-group"},[n("label",{staticClass:"control-label col-sm-2"},[t._v("\n              "+t._s(e[0].toUpperCase()+e.slice(1))+":\n            ")]),t._v(" "),n("div",{staticClass:"col-sm-8"},[t.editCheckbox[e]?t._e():n("div",{staticClass:"form-control"},[t._v("\n                "+t._s(t.parseTime(t.bot[e]))+"\n              ")]),t._v(" "),t.editCheckbox[e]?n("input",{directives:[{name:"model",rawName:"v-model",value:t.botChanges[e],expression:"botChanges[item]"}],attrs:{type:"time"},domProps:{value:t.botChanges[e]},on:{input:function(n){n.target.composing||t.$set(t.botChanges,e,n.target.value)}}}):t._e()]),t._v(" "),n("div",{staticClass:"col-sm-1"},[t.editCheckbox[e]||"start"==e?t._e():n("button",{staticClass:"btn btn-primary",on:{click:function(n){t.setEdit(e)}}},[t._v("\n                Edit\n              ")]),t._v(" "),t.editCheckbox[e]?n("button",{staticClass:"btn btn-danger",on:{click:function(n){t.setEdit(e)}}},[t._v("\n                Reset\n              ")]):t._e()])])]):t._e()})],2),t._v(" "),n("div",{staticClass:"modal-footer"},["add"==t.infoMode?n("button",{staticClass:"btn btn-primary",on:{click:t.addNewBot}},[t._v("\n          Add\n        ")]):t._e(),t._v(" "),"add"==t.infoMode?n("button",{staticClass:"btn btn-warning",on:{click:t.discardNewBot}},[t._v("\n          Discard\n        ")]):t._e(),t._v(" "),t.isRunning()?n("button",{staticClass:"btn btn-warning",on:{click:t.stopRunningTimer}},[t._v("\n          Stop timer\n        ")]):t._e(),t._v(" "),0!=Object.keys(t.botChanges)?n("button",{staticClass:"btn btn-primary",on:{click:t.editBotInfo}},[t._v("\n          Set changes\n        ")]):t._e(),t._v(" "),"info"==t.infoMode?n("button",{staticClass:"btn btn-danger",attrs:{"data-toggle":"collapse","data-target":"#are-you-sure"},on:{click:function(e){t.setDeleteMode("delete")}}},[t._v("\n          Delete\n        ")]):t._e(),t._v(" "),n("button",{staticClass:"btn btn-info",attrs:{"data-dismiss":"modal"}},[t._v("\n          Close\n        ")]),t._v(" "),n("div",{staticClass:"collapse",attrs:{id:"are-you-sure"}},[n("p",[t._v("Are you sure ?")]),t._v(" "),"delete"==t.deleteMode?n("button",{staticClass:"btn btn-primary",on:{click:t.deleteBot}},[t._v("\n            Yes\n          ")]):t._e(),t._v(" "),n("button",{staticClass:"btn btn-danger",attrs:{"data-toggle":"collapse","data-target":"#are-you-sure"}},[t._v("\n            No\n          ")])])])])])])},staticRenderFns:[]};var A={name:"BotList",props:["botList"],methods:{displayBotInfo:function(t){for(var e in this.$parent.infoMode="info",this.botList[t])this.$parent.selectedBot[e]=this.botList[t][e]},isActive:function(t){return t.stop&&t.stop>(new Date).getTime()}}},U={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("transition-group",{staticClass:"container-fluid",attrs:{name:"list",tag:"div"}},t._l(t.botList,function(e,o){return n("div",{key:o,staticClass:"col-xs-4 btn list-item",class:t.isActive(e)?"btn-primary":"btn-danger",attrs:{"data-toggle":"modal","data-target":"#bot-info-modal"},on:{click:function(e){t.displayBotInfo(o)}}},[n("h4",[t._v(t._s(e.name))])])}))],1)},staticRenderFns:[]};var P={name:"Dashboard",components:{TopNav:l,BottomNav:T,BotInfo:n("VU/8")(M,R,!1,function(t){n("rf5l")},"data-v-55487878",null).exports,BotList:n("VU/8")(A,U,!1,function(t){n("WvBg")},"data-v-d466f17a",null).exports},mounted:function(){this.getBotList()},data:function(){return{infoMode:"add",botList:[],selectedBot:{name:"",email:"",msg:"",start:"",stop:""}}},methods:{getBotList:function(){var t=this;this.botList=[],setTimeout(function(){var e=window.localStorage.getItem("bot_list");e&&e.split(", ").forEach(function(e){t.botList.push(function(t){let e={name:t};return E.forEach(n=>{let o=window.localStorage.getItem(`${t}_${n}`);if("stop"==n&&(!o||parseInt(o)<(new Date).getTime()))return e.start=null,void(e.stop=null);e[n]=o}),e}(e))})},500)}}},O={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"container-fluid main-container"},[e("bot-info",{attrs:{infoMode:this.infoMode,bot:this.selectedBot}}),this._v(" "),e("top-nav"),this._v(" "),e("bot-list",{attrs:{botList:this.botList.filter(function(t){return t.name})}}),this._v(" "),e("bottom-nav")],1)},staticRenderFns:[]};var H=n("VU/8")(P,O,!1,function(t){n("bW9+")},null,null).exports;o.a.use(i.a);var V=new i.a({routes:[{path:"/",name:"Dashboard",component:H}]});o.a.config.productionTip=!1,new o.a({el:"#app",router:V,components:{App:s},template:"<App/>"})},WvBg:function(t,e){},ZT89:function(t,e){},"bW9+":function(t,e){},evEA:function(t,e){},rf5l:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.13f3f57c9c9b8ca350f0.js.map